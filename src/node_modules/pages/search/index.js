import React, { useState, useEffect } from 'react'
import axios from 'axios'
import { Link, Redirect } from 'react-router-dom'

import './index.css'
import Search from 'components/search'
import Loader from 'components/loader'


const SearchResult = ({ match }) => {
    console.log('queryString', match);
    const [planets, setPlanets] = useState([])
    const [isLoading, setIsLoading] = useState(false)

    const fetchPlanets = () => {
        const queryString = match.params.queryString
        setIsLoading(true)

        const apiUrl = `https://api.le-systeme-solaire.net/rest/bodies/?filter[]=englishName,cs,${queryString}`
        const req = axios.get(apiUrl)
        req.then(res => {
            setPlanets(res.data.bodies)
            setIsLoading(false)
        }).catch(err => {
            console.log(err.errors)
        })
    }

    useEffect(() => {
        fetchPlanets()
        // eslint-disable-next-line
    }, [match.params.queryString])

    if (isLoading) {
        return <Loader />
    }

    if (match.params.queryString === '') {
        return <Redirect to="/" />
    }

    function renderPlanetLinks(planets) {
        return (
            <ul>
                {
                    planets.map(planet => (
                        <h2 key={planet.id}>
                            <Link to={`/planet/${planet.id}`}>
                                {planet.englishName}
                            </Link>
                        </h2>
                    ))
                }
            </ul>
        )
    }

    if (!planets) {
        return <Loader />
    }

    return (
        <div className="container">
            <div className="row">
                <span className="btn btn-link btn-lg">
                    <Link to="/">
                        <i className="glyphicon glyphicon-home"></i> &nbsp; Home page
                    </Link>
                </span>
                <div className="col-sm-3 pull-right">
                    <Search initialValue={match.params.queryString} />
                </div>
                <h1 className="text-center">Search result</h1>
                {planets.length === 0 &&
                    <h2>Planets not found...</h2>
                }
                {planets.length > 0 ? renderPlanetLinks(planets) : null}
            </div>
        </div>
    )
}

export default SearchResult